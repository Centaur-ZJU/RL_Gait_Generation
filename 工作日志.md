## 2020.5.10 星期日

新装了ubuntu20.04 LTS  
安装了 spinningup  
新系统的软件及设置

## 2020.5.11 星期一

修改 /home/chk/spinningup/spinup/user_config.py 文件  
将 spinningup 训练数据默认保存路径为 "/home/chk/文档/Centaur/data"  
`DEFAULT_DATA_DIR = "/home/chk/文档/Centaur/data"`  

安装了 pybullet：  
`pip3 install pybullet`  

pybullet GUI (21.482s) 与 DIRECT (21.082s) 模式在时间上没有差别  
其中 GUI 还有图像界面出现  

目前想法是用 pybullet 注册 gym 环境，然后用 spinningup 直接跑  
存在以下问题：  
1. spinningup 的命令行模式无法直接运行 pybullet_gym 环境  
   + ~~下面两种方法并没有解决训练问题，每次训练时都会提前截断轨迹，而没有正常进行训练，应该是因为 pybullet 的问题导致的~~  
     接下来去找 pybullet 自带的环境源码看看情况，再尝试自己编写 pybullet+gym 的环境时弄懂了，该问题已解决  
   + ~~这个问题暂时用 `gym_env.py` 解决了~~  
     数据图表可以用 plot 画出来  
     但是测试出现问题: `pybullet.error: Couldn't restore state.`   
     已解决，这是因为 test_policy 使用了保存下来的环境数据，使用时没有重新 connect pybullet 引擎，只要重新 make 一下，再用 run_policy 测试即可，详见 `my_test_policy.py`
   + 另一种方法: 在 `gym/envs/__init__.py` 6-11 行注册了 pybullet_gym 的环境，注册后即可用命令行进行训练  
2. 看 pybullet 自带的 gym 环境非常复杂，如果自己写环境也这么复杂的话怕是有点困难  
3. 参数的调整将会是个复杂且长期的工作  

## 2020.5.12-2020.5.13

pybullet_gym 毕竟不是纯粹的 gym 环境，适配的问题较大，决定暂时搁置  
接下来尝试自己写使用 pybullet 的 gym 环境：  
- [x] 写一个没有 pybullet 的简单环境并注册到 gym 中进行训练  
    - [x] 使用 gym [官方教程](https://github.com/openai/gym/blob/master/docs/creating-environments.md)注册一个空环境  
    - [x] 完成，训练、测试、画图均正常，见 myGymEnv/， 主要参考了 gym-pendulum 源码;参考 [gym-soccer](https://github.com/openai/gym-soccer)、[OpenAI Gym构建自定义强化学习环境](https://blog.csdn.net/extremebingo/article/details/80867486)、[强化学习：gym库的二次开发学习](https://www.jianshu.com/p/2062b6bef5ea) 等文章和 gym-pendulum 源码简单修改环境，使的 spinup 能够在其上正常训练，不被异常中断  
- [ ] 完成使用 pybullet 为引擎、能用 spinup 训练的 gym 环境  
    - [ ] 给 myGymEnv 加入 pybullet，测试 init,step,render 等功能, 参考了 pybullet_envs/env_bases.py  
        - [x] 加入 pybullet 引擎并能够渲染，spinup test_policy 功能似乎并不是重新构造环境，而是从保存下来的数据中恢复环境，然后测试策略，这导致了测试时会有 pybullet 未连接的情形，因为恢复的环境中其 physicsClientId 非负，表示它连接着引擎，而实际上训练时的引擎已经被关闭了，测试时并没有连接引擎，由此而报错  
        - [x] ~~自己写一个测试程序，或~~解决 spinup test_policy 的异常， 见`my_test_policy_py`  
        - [ ] 用 pybullet-gym 中的 HumanoidFlagrunBulletEnv-v0 训练一晚，看看训练效果如何
              一个 epoch 大约用时 2s，总共进行 6 种 共 18 次实验(3个随机种子，3种网络，2种激活函数),设定总 epochs=1000, 预计用时9小时  
              开始于 2020.5.13-20:49  
        - [ ] 载入机器人模型并进行操控  

使用 spinup 训练 Centaur-v0 时， steps_per_epoch 小于4000时会报错  